(function(o,d){"function"===typeof define&&define.amd?define([],function(){var f={};d(f);return f}):"object"===typeof exports?d(exports):d(o)})(this,function(o){var d,f,m,j,k=function(){};k.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};k.substr=function(a,b,c){if(null!=b&&0!=b&&null!=c&&0>c)return"";null==c&&(c=a.length);0>b?(b=a.length+b,0>b&&(b=0)):0>c&&(c=a.length+c-b);return a.substr(b,c)};var n=function(){};n.main=function(){(new f(window.document)).ready(function(){var a=n.getScriptSrcParameters("mbp_rectanglePacker");
if(null!=a){var b;b=a.exists("container")?a.get("container"):"#rectContainer";var c=i.parseInt(a.get("xCellSize")),g=i.parseInt(a.get("yCellSize")),e=i.parseInt(a.get("padX")),a=i.parseInt(a.get("padY"));new f(b);for(var h=0;32>h;)h++,(new f(b)).append(new f('<div class="packableElement" style="width:'+(32+i.random(96))+"px;height:"+(32+i.random(96))+'px;"></div>'));d.rectanglepacking.Packer.create(b,c,g,e,a)}})};n.getScriptSrcParameters=function(a){a=new f("script[data*="+a+"]");if(0==a.length)return null;
var a=a.attr("src"),b=a.indexOf("?")+1,a=k.substr(a,b,null).split("&"),b=new m.StringMap;if(2>a.length)return null;for(var c=0,d=a.length;c<d;){var e=c++,e=a[e].split("=");b.set(e[0],e[1])}return b};var i=function(){};i.parseInt=function(a){var b=parseInt(a,10);if(0==b&&(120==k.cca(a,1)||88==k.cca(a,1)))b=parseInt(a);return isNaN(b)?null:b};i.random=function(a){return 0>=a?0:Math.floor(Math.random()*a)};j=m=void 0;j=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};j.delay=function(a,
b){var c=new j(b);c.run=function(){c.stop();a()};return c};j.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};m={StringMap:function(){this.h={}}};m.StringMap.__interfaces__=[function(){}];m.StringMap.prototype={set:function(a,b){this.h["$"+a]=b},get:function(a){return this.h["$"+a]},exists:function(a){return this.h.hasOwnProperty("$"+a)}};d=f=void 0;d={rectanglepacking:{}};d.rectanglepacking.Packer=o.RectanglePacker=function(a,b,c,g,e){null==e&&(e=
8);null==g&&(g=8);null==c&&(c=8);null==b&&(b=8);var h=this;this.container=new f(a);if(0==this.container.length)throw'Container element "'+a+'" does not exist.';this.xCellSize=b;this.yCellSize=c;this.padX=g;this.padY=e;1>b&&(b=1);1>c&&(c=1);this.tempPt=new d.rectanglepacking.geom.Point;this.outerBounds=d.rectanglepacking.Packer.getDomElementBounds(this.container[0]);this.fixedElements=new f(a+" div.fixedElement");this.packableElements=new f(a+" div.packableElement");this.packables=[];this.packableElements.each(function(a,
b){h.packables.push(new d.rectanglepacking.Packable(a,b))});this.fixedPositions=[];this.fixedElements.each(function(a,b){h.fixedPositions[a]=d.rectanglepacking.Packer.getDomElementBounds(b)});this.packableElements.css("display","none");this.prepare();this.fixedElements.remove();0<this.packables.length?this.packItem(0):console.log("Nothing to pack...?")};d.rectanglepacking.Packer.create=function(a,b,c,g,e){null==e&&(e=8);null==g&&(g=8);null==c&&(c=8);null==b&&(b=8);return new d.rectanglepacking.Packer(a,
b,c,g,e)};d.rectanglepacking.Packer.getDomElementBounds=function(a){var b=a.style,c=i.parseInt(k.substr(b.width,0,b.width.length-2)),g=i.parseInt(k.substr(b.height,0,b.height.length-2));null==c&&(c=a.clientWidth);null==g&&(g=a.clientHeight);a=i.parseInt(b.top);b=i.parseInt(b.left);Math.isNaN(a)&&(a=0);Math.isNaN(b)&&(b=0);return new d.rectanglepacking.geom.Rectangle(b,a,c,g)};d.rectanglepacking.Packer.prototype={prepare:function(){var a=new f("div#fixed-master.fixedElement");0==a.length?(console.log("#fixed-master not found in .fixedElement items. Using the container instead..."),
a=this.outerBounds.clone()):a=d.rectanglepacking.Packer.getDomElementBounds(a[0]);this.sortPackableItemsByArea();this.targetPoint=new d.rectanglepacking.geom.Point(a.x+Math.round(a.width/2),a.y+Math.round(a.height/2))},packItem:function(a){var b=this,c=null,d=(new Date).getTime(),e=this.packables[this.areaSortedIndices[a]];!e.packed&&!e.unpackable&&(c=this.findSpace(this.targetPoint,e.rect.clone()),null==c?(console.log("Out of space! Can't place item "+e.index+" "+(new f(e.element)).html()),e.unpackable=
!0,(new f(e.element)).remove()):(console.log("Placing item "+e.index+" at "+c.toString()),e.packed=!0,this.fixedPositions.push(c),e.jElement.css({left:c.x}).css({top:c.y}).css("display","block").removeClass("packableElement").addClass("packedElement")));c=(new Date).getTime()-d;a++;a==this.packables.length?this.packComplete():40<c?j.delay(function(){b.packItem(a)},40):this.packItem(a)},packComplete:function(){console.log("Packing complete")},findSpace:function(a,b){b.inflate(this.padX,this.padY);
for(var c=Math.round(this.outerBounds.width/this.xCellSize),g=Math.round(this.outerBounds.height/this.yCellSize),e=0,h=0,f=0,h=0,i=this.fixedPositions.length,k=!1,j=this.outerBounds.width*this.outerBounds.height,e=!1,p=new d.rectanglepacking.geom.Rectangle,l,j=j*j,m=0;m<c;){f=m++*this.xCellSize;b.x=f;for(var n=0;n<g;){h=n++;e=!1;h*=this.yCellSize;b.y=h;if(b.get_bottom()<=this.outerBounds.get_bottom())for(var o=0;o<i;)l=this.fixedPositions[o++],e=e||((l.get_right()>b.get_right()?b.get_right():l.get_right())<=
(l.x<b.x?b.x:l.x)?!1:(l.get_bottom()>b.get_bottom()?b.get_bottom():l.get_bottom())>(l.y<b.y?b.y:l.y));else e=!0;e||(k=!0,this.tempPt.x=f,this.tempPt.y=h,e=a.x-this.tempPt.x,h=a.y-this.tempPt.y,e=e*e+h*h,e<j&&(j=e,p.x=b.x,p.y=b.y,p.width=b.width,p.height=b.height))}}if(!k)return console.log("I'm sorry, I can't place that Dave."),null;p.inflate(-this.padX,-this.padY);return p},sortPackableItemsByArea:function(){for(var a=[],b=0,c=this.packables.length;b<c;){var d=b++;a.push({index:d,area:this.packables[d].rect.get_area()})}a.sort(function(a,
b){return a.area>b.area?-1:a.area<b.area?1:0});this.areaSortedIndices=[];b=0;for(c=this.packables.length;b<c;)d=b++,this.areaSortedIndices[d]=a[d].index}};d.rectanglepacking.Packable=function(a,b){b.id="packable_"+a;this.jElement=new f(b);this.packed=this.unpackable=!1;this.element=b;this.index=a;this.rect=d.rectanglepacking.Packer.getDomElementBounds(b)};d.rectanglepacking.geom={};d.rectanglepacking.geom.Point=function(a,b){this.x=null==a?0:a;this.y=null==b?0:b};d.rectanglepacking.geom.Point.prototype=
{clone:function(){return new d.rectanglepacking.geom.Point(this.x,this.y)}};d.rectanglepacking.geom.Rectangle=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.width=c;this.height=d};d.rectanglepacking.geom.Rectangle.intersects=function(a,b){return(a.get_right()>b.get_right()?b.get_right():a.get_right())<=(a.x<b.x?b.x:a.x)?!1:(a.get_bottom()>b.get_bottom()?b.get_bottom():a.get_bottom())>(a.y<b.y?b.y:a.y)};d.rectanglepacking.geom.Rectangle.prototype=
{toString:function(){return"[Rectangle x:"+this.x+", y:"+this.y+", w:"+this.width+", h:"+this.height+"]"},get_area:function(){return this.width*this.height},get_left:function(){return this.x},get_right:function(){return this.x+this.width},get_top:function(){return this.y},get_bottom:function(){return this.y+this.height},get_topLeft:function(){return new d.rectanglepacking.geom.Point(this.x,this.y)},get_size:function(){return new d.rectanglepacking.geom.Point(this.width,this.height)},get_bottomRight:function(){return new d.rectanglepacking.geom.Point(this.x+
this.width,this.y+this.height)},clone:function(){return new d.rectanglepacking.geom.Rectangle(this.x,this.y,this.width,this.height)},inflate:function(a,b){this.x-=a;this.width+=a<<1;this.y-=b;this.height+=b<<1}};Math.NaN=Number.NaN;Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;Math.isFinite=function(a){return isFinite(a)};Math.isNaN=function(a){return isNaN(a)};f="function"===typeof define&&define.amd?require("jquery"):window.jQuery;n.isDebug=!1;d.rectanglepacking.Packer.MAX_PACK_TIME=
40;n.main()});
